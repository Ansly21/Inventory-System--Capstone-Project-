<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/css.gg@2.0.0/icons/css/shopping-cart.css' rel='stylesheet'>
    <link href='https://unpkg.com/css.gg@2.0.0/icons/css/danger.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>

    <link rel="stylesheet" href="/Reports (Admin).css">
    <title>Reports (Admin)</title>
     <!-- Include Chart.js from CDN -->
     <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <header>
        <div class="image">
            <a href="/">
                <img src="/Six7TwoLogo.png" alt="">
            </a>
        </div>

            <h1 id="title">REPORTS</h1>
 
    </header>

    <main>
        <div class="nav">
            <a href="/products">
                <button>Products</button>
            </a>

            <a href="/inventory">
                <button>Inventory</button>
            </a>

            <a href="/reports">
                <button class="page-btn">Reports</button>
            </a>

            <a href="account">
                <button>Accounts</button>
            </a>
        </div>


        <div class="right-side">
            <section>
                <div class="info-container totalProductsContainer">
                    <i class="bi bi-cart-plus"></i>
                    <div class="info">
                        <p class="info-title">Total Products</p>
                        <p class="info-num"><%= totalProducts %></p>
                    </div>
                </div>

                <div class="info-container lowStockContainer">
                    <i class="bi bi-exclamation-circle"></i>
                    <div class="info">
                        <p class="info-title">Low Stock</p>
                        <p class="info-num"><%= lowStock %></p>
                    </div>
                </div>

                <div class="info-container stockValueContainer">
                    <i class="bi bi-coin"></i>
                    <div class="info">
                        <p class="info-title">Stock Value</p>
                        <p class="info-num"><%= stockValue %></p>
                    </div>
                </div>

                <div class="info-container stockCostContainer">
                    <i class="bi bi-cash-stack"></i>
                    <div class="info">
                        <p class="info-title">Stock Cost</p>
                        <p class="info-num"><%= stockCost %></p>
                    </div>
                </div>
            </section>


            <select name="" id="selectOptions" class="selectOptions">
                <option value="sample">Choose</option>
                <option value="lowstock">Low Stock</option>
                <option value="bestSeller">Best Seller</option>
                <option value="leastSeller">Least Seller</option>
                <option value="topRevenue">Top Revenue</option>
                <option value="leastRevenue">Least Revenue</option>
            </select>

            <div class="table-container" id="table-container">
                <!-- DYNAMICALLY RENDER TABLE-->

                
            </div>
        </div>

       
<%= totalProducts %>
        
    </main>


    <script src="https://kit.fontawesome.com/b0d1390b7c.js" crossorigin="anonymous"></script>
    <canvas id="myChart" width="60" height="15"></canvas>

    <script>

var option;

    //TABLE CODE



    let lowStockNameArray = '<%= lowStockName %>'.split(',');
    let closingInvArray = '<%= closingInv %>'.split(',');
    let lowStockThresholdArray = '<%= lowStockThreshold %>'.split(',');
    
      
        
        document.getElementById("selectOptions").addEventListener("change", () => {
    console.log("Dropdown selection changed"); // Check if this log appears in the console
    // option = document.getElementById("selectOptions").value
    //console.log(option);
    

    // Rest of your code for generating the table...
});

 

    document.getElementById("selectOptions").addEventListener("change", () => {
        if (document.getElementById("selectOptions").value === "lowstock") {
            // Assuming lowStockNameArray, closingInvArray, and lowStockThresholdArray are already available as arrays
            const lowStockName = lowStockNameArray;
            const closingInv = closingInvArray;
            const lowStockThreshold = lowStockThresholdArray;

            const tableContainer = document.getElementById('table-container');
            const table = document.createElement('table');
            table.id = "report-table"
            table.innerHTML = `
                <caption>LOW STOCK TABLE</caption>
                <tr>
                    <th>Code</th>
                    <th>Product Name</th>
                    <th>Current Stock</th>
                    <th>Low Stock Threshold</th>
                </tr>
            `;

            lowStockName.forEach((item, index) => {
                const row = table.insertRow();
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item}</td>
                    <td>${closingInv[index]}</td>
                    <td>${lowStockThreshold[index]}</td>
                `;
                
                table.appendChild(row);

            });

            // Clear previous table, if any, and append the new table
            tableContainer.innerHTML = '';
            tableContainer.appendChild(table);


            // ... your previous code for displaying the table

        // Create the download button
        const downloadContainer = document.createElement('div');
        downloadContainer.classList.add('download-container');
        downloadContainer.innerHTML = `
            <button id="downloadBtn">Download as PDF</button>
        `;

        // Append the download button after the table
        tableContainer.appendChild(downloadContainer);

        window.jsPDF = window.jspdf.jsPDF;
        document.getElementById("downloadBtn").addEventListener("click", () => {
  const doc = new jsPDF();

  // Convert table to PDF format
  doc.autoTable({ html: '#report-table' });

  // Save the PDF file
  doc.save('table.pdf');
});


    }});





        //GRAPHS CODE BELOOW

        // Best Seller Chart

        var canvas = document.getElementById("myChart");

        
        var topSellerString = '<%= topSellerName%>';
        console.log(topSellerString);

        const topSellerArrayName = topSellerString.split(',');
        console.log(topSellerArrayName);

        var topSellerStringValues = '<%= topSellerValue%>';
        console.log(topSellerString);

        const topSellerArrayValue = topSellerStringValues.split(',');
        console.log(topSellerArrayValue);

         // Top Revenue Chart
        var topRevenueName = '<%= revenueProductName%>';
        const topRevenueNameArray = topRevenueName.split(',');
        

        var topRevenueValue = '<%= revenueValue%>';
        const topRevenueValueArray = topRevenueValue.split(',');

         // Least Seller Chart
        var leastSellerValuesString = '<%= leastSelectedValuesSold %>';
        const leastSellerValuesArray = leastSellerValuesString.split(',');

        var leastSellerNameString = '<%= leastSelectedValuesName %>';
        const leastSellerNameArray = leastSellerNameString.split(',');

        // Least Revenue Chart
        var leastRevenueNameString = '<%= leastRevenueProductName %>';
        const leastRevenueNameArray = leastRevenueNameString.split(',');

        var leastRevenueValueString = '<%= leastRevenueValue %>';
        const leastRevenueValueArray = leastRevenueValueString.split(',');
                

        // Variables for the first bar chart
       
        var option = "bestSeller";
        var labels1;
        var data1;
        var LabelOfChart;
        var color;
        var lineColor;

        if(option === "bestSeller"){
            
                LabelOfChart = "Bestseller";

                labels1 = topSellerArrayName;
                data1 = topSellerArrayValue;
                color = 'rgba(75, 192, 192, 0.2)';
                lineColor = 'rgba(75, 192, 192, 1)';
                

        }else if(option === "topRevenue"){

                LabelOfChart = "Top Revenue";
                
                labels1 = topRevenueNameArray;
                data1 = topRevenueValueArray;
        
                color = 'rgba(75, 192, 192, 0.2)';
                lineColor = 'rgba(75, 192, 192, 1)';
    
       
        }else if(option === "leastSeller"){

            LabelOfChart = "Least Seller";
                
                labels1 = leastSellerNameArray;
                data1 = leastSellerValuesArray;

                color = 'rgba(255, 99, 132, 0.2)';
                lineColor = 'rgba(255, 99, 132, 1)';


        }else if(option ==="leastRevenue"){

            LabelOfChart = "Least Revenue";
                
                labels1 = leastRevenueNameArray;
                data1 = leastRevenueValueArray;
                color = 'rgba(255, 99, 132, 0.2)';
                lineColor = 'rgba(255, 99, 132, 1)';

        }else if(option ==="lowstock"){


            canvas.style.display = "none";
        }
        /*
        // Variables for the second bar chart
        var labels2 = ['Ballpen', 'Category B', 'Category C', 'Category D', 'Category E'];
        var data2 = [15, 30, 45, 25, 55];*/
    
        // Get the canvas element and its context
        var canvas = document.getElementById('myChart');
        var ctx = canvas.getContext('2d');
    
        // Create a bar chart with two datasets
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels1,
                datasets: [{
                    label: LabelOfChart,
                    data: data1,
                    backgroundColor: color,
                    borderColor: lineColor,
                    borderWidth: 1
                }
                
                /*, {
                    label: 'Current Stock',
                    data: data2,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1
                }*/]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    </script>
    
</body>
</html>